#clmchg fields: cclgmpr1 | cclgmtn1 | cclgmtx1 = last glacial maximum; cc45pr501 | cc45tn501 | cc45tx501 = future climate 2070 conservative; prec_1 | tmin_1 | tmax_1= present climate 1990; tn or tmin is daily minimum, pr or prec is precipitation; tx or tmax is daily maximum. Numbering 1-12 is month.
ghc_prec <- rbind(adjprecipitation, rawprecipitation)
ghc_prec <- unique(ghc_prec[,c(1,3:15)])
for (j in 1:12){
ghc_prec[,j+2] <- ifelse(ghc_prec[,j+2] == -8888, 0.2,ghc_prec[,j+2]/10)
}
ghc_tmean <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TAVG' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_tmean) <- c('ID', 'YEAR', 't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12')
ghc_tlow <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TMIN' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_tlow) <- c('ID', 'YEAR', 'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')
ghc_thigh <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TMAX' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_thigh) <- c('ID', 'YEAR', 'th01', 'th02', 'th03', 'th04', 'th05', 'th06', 'th07', 'th08', 'th09', 'th10', 'th11', 'th12')
ghc_t <- merge(ghc_tmean,ghc_tlow, by=c('ID','YEAR'), all.x=TRUE, all.y=TRUE)
ghc_t <- merge(ghc_t,ghc_thigh, by=c('ID','YEAR'), all.x=TRUE, all.y=TRUE)
ghc_t[,3:38] <- ghc_t[,3:38] / 100
ghc <- merge(ghc_t,ghc_prec, by.x=c('ID','YEAR'),by.y=c('ID','year'))
rm(ghc_thigh,ghc_tlow,ghc_tmean )
ghc$check <- (ghc$th01 + ghc$tl01 + ghc$th07 + ghc$th07 + ghc$p01 + ghc$p07)*0+1
ghc1990 <- ghc[ghc$YEAR >= 1961  & ghc$YEAR <= 1990,  ]
ghc1990checkyears <- aggregate(ghc1990[,'check'], by=list(ghc1990$ID), FUN= 'sum', na.rm=TRUE)
colnames(ghc1990checkyears) <- c('ID', 'ct1990')
ghc2010 <- ghc[ghc$YEAR >= 1981  & ghc$YEAR <= 2010,  ]
ghc2010checkyears <- aggregate(ghc2010[,'check'], by=list(ghc2010$ID), FUN= 'sum', na.rm=TRUE)
colnames(ghc2010checkyears) <- c('ID', 'ct2010')
ghccheckyears <- merge(ghc2010checkyears, ghc1990checkyears, by='ID')
rm(ghc2010checkyears, ghc1990checkyears)
selectID <- ghccheckyears[ghccheckyears$ct2010 >=20 & ghccheckyears$ct1990 >=20,'ID']
ghc <- ghc[ghc$ID %in% selectID,]
for (j in 1:12){
ghc[,which(colnames(ghc)=='t01')+j-1]<- ifelse(is.na(ghc[,which(colnames(ghc)=='t01')+j-1]),
(ghc[,which(colnames(ghc)=='tl01')+j-1] + ghc[,which(colnames(ghc)=='th01')+j-1])/2,
ghc[,which(colnames(ghc)=='t01')+j-1])
}
ghcpre <-  ghc[ghc$YEAR >= 1961  & ghc$YEAR <= 1990,]
ghc1990norm <- aggregate(ghcpre[,c(
't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12',
'p01', 'p02', 'p03', 'p04', 'p05', 'p06', 'p07', 'p08', 'p09', 'p10', 'p11', 'p12',
'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')],
by=list(ghcpre$ID), FUN = 'mean', na.rm=TRUE
)
ghcpre <-  ghc[ghc$YEAR >= 1981  & ghc$YEAR <= 2010,]
ghc2010norm <- aggregate(ghcpre[,c(
't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12',
'p01', 'p02', 'p03', 'p04', 'p05', 'p06', 'p07', 'p08', 'p09', 'p10', 'p11', 'p12',
'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')],
by=list(ghcpre$ID), FUN = 'mean', na.rm=TRUE
)
ghc2010norm$Norm <- 2010
ghc1990norm$Norm <- 1990
ghc2010norm <- rbind(ghc2010norm, ghc1990norm)
colnames(ghc2010norm)[1] <- 'ID'
globstations <- merge(globstations,ghc2010norm, by='ID' )
rm(GHC_ELEMENTS, adjprecipitation, rawprecipitation, globhistclim, globhistoricecoregions, ghc, ghcpre, ghc_prec, ghc_thigh, ghc_t,
ghc_tlow, ghc1990norm, ghc2010norm, ghc1990, ghc2010, ghc2010checkyears, ghc1990checkyears, ghccheckyears)
globstations$Source <- "GHCN"
globstations$State <- ""
colnames(globstations)[which(colnames(globstations)=='ID')] <- "Station_ID"
colnames(globstations)[which(colnames(globstations)=='stnname')] <- "Station_Name"
colnames(globstations)[which(colnames(globstations)=='latitude')] <- "Latitude"
colnames(globstations)[which(colnames(globstations)=='longitude')] <- "Longitude"
colnames(globstations)[which(colnames(globstations)=='elev')] <- "Elevation"
colnames(globstations)
#norms----
Norms2010$p01 <- Norms2010$pp01*10
Norms2010$p02 <- Norms2010$pp02*10
Norms2010$p03 <- Norms2010$pp03*10
Norms2010$p04 <- Norms2010$pp04*10
Norms2010$p05 <- Norms2010$pp05*10
Norms2010$p06 <- Norms2010$pp06*10
Norms2010$p07 <- Norms2010$pp07*10
Norms2010$p08 <- Norms2010$pp08*10
Norms2010$p09 <- Norms2010$pp09*10
Norms2010$p10 <- Norms2010$pp10*10
Norms2010$p11 <- Norms2010$pp11*10
Norms2010$p12 <- Norms2010$pp12*10
Norms2010 <- merge(ecolink, Norms2010, by='Station_ID')
Norms2010$Norm <- 2010
Norms2010$Source <- "2010 Normals"
Norms2010pre <-Norms2010[!is.na(Norms2010$t01)&!is.na(Norms2010$t07)&!is.na(Norms2010$tl01)&!is.na(Norms2010$tl07)&!is.na(Norms2010$p01)&!is.na(Norms2010$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate$Station_ID <- ""
Biomeclimate$Station_Name <- ""
Biomeclimate$State <- ""
Biomeclimate$Norm <- 1990
Biomeclimate$Source <- "WorldClim.org"
Biomeclimatepre <-Biomeclimate[!is.na(Biomeclimate$t01)&!is.na(Biomeclimate$t07)&!is.na(Biomeclimate$tl01)&!is.na(Biomeclimate$tl07)&!is.na(Biomeclimate$p01)&!is.na(Biomeclimate$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate <- rbind(Biomeclimatepre,Norms2010pre)
globstationspre <-globstations[!is.na(globstations$t01)&!is.na(globstations$t07)&!is.na(globstations$tl01)&!is.na(globstations$tl07)&!is.na(globstations$p01)&!is.na(globstations$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate <- rbind(Biomeclimate,globstationspre)
Biomeclimate <- merge(biomesummary, Biomeclimate, by='BIOME')
Biomeclimate$wts<- ifelse(Biomeclimate$Source %in% 'GHCN', 100,1)
#generate Uniq ID
Biomeclimate$ID <- seq.int(nrow(Biomeclimate))
rm(ecolink, Norms2010, Norms2010pre, biomesummary, Biomeclimatepre, globstationspre)
Biomeclimate<-Biomeclimate[,c("ID","ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm", "Source","wts", "Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
N1990 <- Biomeclimate[Biomeclimate$Norm == 1990,]
N2010 <- Biomeclimate[Biomeclimate$Norm == 2010,]
wwfregions1 <- aggregate(N1990[,c('ID')], by=list(N1990$ECO_ID,N1990$ECO_NAME), FUN='length')
colnames(wwfregions1) <- c('ECO_ID', 'ECO_NAME', 'N1990')
wwfregions2 <- aggregate(N2010[,c('ID')], by=list(N2010$ECO_ID,N2010$ECO_NAME), FUN='length')
colnames(wwfregions2) <- c('ECO_ID', 'ECO_NAME', 'N2010')
wwfregions<- merge(wwfregions2, wwfregions1[,c('ECO_ID', 'N1990')], by='ECO_ID', all.x = TRUE)
wwfregions$cht01 <- 0
wwfregions$cht02 <- 0
wwfregions$cht03 <- 0
wwfregions$cht04 <- 0
wwfregions$cht05 <- 0
wwfregions$cht06 <- 0
wwfregions$cht07 <- 0
wwfregions$cht08 <- 0
wwfregions$cht09 <- 0
wwfregions$cht10 <- 0
wwfregions$cht11 <- 0
wwfregions$cht12 <- 0
wwfregions$chtl01 <- 0
wwfregions$chtl02 <- 0
wwfregions$chtl03 <- 0
wwfregions$chtl04 <- 0
wwfregions$chtl05 <- 0
wwfregions$chtl06 <- 0
wwfregions$chtl07 <- 0
wwfregions$chtl08 <- 0
wwfregions$chtl09 <- 0
wwfregions$chtl10 <- 0
wwfregions$chtl11 <- 0
wwfregions$chtl12 <- 0
wwfregions$chp01 <- 0
wwfregions$chp02 <- 0
wwfregions$chp03 <- 0
wwfregions$chp04 <- 0
wwfregions$chp05 <- 0
wwfregions$chp06 <- 0
wwfregions$chp07 <- 0
wwfregions$chp08 <- 0
wwfregions$chp09 <- 0
wwfregions$chp10 <- 0
wwfregions$chp11 <- 0
wwfregions$chp12 <- 0
for (i in 1:nrow(wwfregions)){ #create a matrix that shows difference between the 1990 and 2010 normals by ecoregion.
selectbioclim <- Biomeclimate[Biomeclimate$ECO_ID %in% wwfregions[i,'ECO_ID'],    c("ID","ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","wts","Latitude","Longitude","Elevation",
"t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12",
"tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12",
"p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12") ]
selectbioclim$v1 <- 0
for (j in 1:12){
selectbioclim$v1 <- selectbioclim[,which(colnames(selectbioclim)=='t01')+j-1]
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='cht01')+j-1] <-
as.numeric(model1$coef[5])
}
for (j in 1:12){
selectbioclim$v1 <- log(selectbioclim[,which(colnames(selectbioclim)=='p01')+j-1] +1 )
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='chp01')+j-1] <-
as.numeric(model1$coef[5])
}
for (j in 1:12){
selectbioclim$v1 <- log(selectbioclim[,which(colnames(selectbioclim)=='t01')+j-1] - selectbioclim[,which(colnames(selectbioclim)=='tl01')+j-1] + 1)
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='chtl01')+j-1] <-
as.numeric(model1$coef[5])
}
}
bioclimatechange <- merge(Biomeclimate[Biomeclimate$Norm == 2010,], wwfregions, by=c('ECO_ID', 'ECO_NAME'))
bioclimatechange$newt01 <- 0
bioclimatechange$newt02 <- 0
bioclimatechange$newt03 <- 0
bioclimatechange$newt04 <- 0
bioclimatechange$newt05 <- 0
bioclimatechange$newt06 <- 0
bioclimatechange$newt07 <- 0
bioclimatechange$newt08 <- 0
bioclimatechange$newt09 <- 0
bioclimatechange$newt10 <- 0
bioclimatechange$newt11 <- 0
bioclimatechange$newt12 <- 0
bioclimatechange$newtl01 <- 0
bioclimatechange$newtl02 <- 0
bioclimatechange$newtl03 <- 0
bioclimatechange$newtl04 <- 0
bioclimatechange$newtl05 <- 0
bioclimatechange$newtl06 <- 0
bioclimatechange$newtl07 <- 0
bioclimatechange$newtl08 <- 0
bioclimatechange$newtl09 <- 0
bioclimatechange$newtl10 <- 0
bioclimatechange$newtl11 <- 0
bioclimatechange$newtl12 <- 0
bioclimatechange$newp01 <- 0
bioclimatechange$newp02 <- 0
bioclimatechange$newp03 <- 0
bioclimatechange$newp04 <- 0
bioclimatechange$newp05 <- 0
bioclimatechange$newp06 <- 0
bioclimatechange$newp07 <- 0
bioclimatechange$newp08 <- 0
bioclimatechange$newp09 <- 0
bioclimatechange$newp10 <- 0
bioclimatechange$newp11 <- 0
bioclimatechange$newp12 <- 0
for (j in 1:12){
bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='cht01')+j-1]*20
bioclimatechange[,which(colnames(bioclimatechange)=='newtl01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] - pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='tl01')+j-1] +1) - bioclimatechange[,which(colnames(bioclimatechange)=='chtl01')+j-1]*20) -1, 0) #predict low, ensure that low is never higher than mean.
bioclimatechange[,which(colnames(bioclimatechange)=='newp01')+j-1] <- pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='p01')+j-1] + 1) - bioclimatechange[,which(colnames(bioclimatechange)=='chp01')+j-1]*20) - 1, 0) #predict precip, ensure that precip is never negative.
}
View(bioclimatechange)
bioclimatechange <- bioclimatechange[bioclimatechange$Source %in%'2010 Norms',]
View(bioclimatechange)
View(Biomeclimate)
Biomeclimate <- readRDS("data/BiomeClimate3.RDS")
DaysMonth <- readRDS("data/DaysMonth.RDS")
biomesummary <- readRDS("data/biomesummary.RDS")
Norms2010 <- readRDS("data/Norms2010.RDS")
USH_station <- readRDS("data/USH_station.RDS")
ecolink <- readRDS('data/ecolink.RDS')
USH_stationjoin <- readRDS("data/USH_stationjoin.RDS")
USH_station <- USH_station[,c('lat', 'lon', 'elev', 'state', 'station_Name', 'StationID')]
USH_station <- merge(USH_station, USH_stationjoin, by.x = 'StationID', by.y = 'StationID')
globhistclim <- readRDS("data/globhistclim.RDS")
ecolink2 <- readRDS("data/ecolink2.RDS")
globstations <- merge(globhistclim, ecolink2[,c('ID','ECO_ID', 'ECO_NAME', 'BIOME' )], by='ID')
adjprecipitation <- readRDS("data/adjprecipitation.RDS")
rawprecipitation <- readRDS("data/rawprecipitation.RDS")
GHC_ELEMENTS <- readRDS("data/GHC_ELEMENTS.RDS")
clmchg <- readRDS("data/clmchg.RDS")
#clmchg fields: cclgmpr1 | cclgmtn1 | cclgmtx1 = last glacial maximum; cc45pr501 | cc45tn501 | cc45tx501 = future climate 2070 conservative; prec_1 | tmin_1 | tmax_1= present climate 1990; tn or tmin is daily minimum, pr or prec is precipitation; tx or tmax is daily maximum. Numbering 1-12 is month.
ghc_prec <- rbind(adjprecipitation, rawprecipitation)
ghc_prec <- unique(ghc_prec[,c(1,3:15)])
for (j in 1:12){
ghc_prec[,j+2] <- ifelse(ghc_prec[,j+2] == -8888, 0.2,ghc_prec[,j+2]/10)
}
ghc_tmean <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TAVG' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_tmean) <- c('ID', 'YEAR', 't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12')
ghc_tlow <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TMIN' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_tlow) <- c('ID', 'YEAR', 'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')
ghc_thigh <- unique(GHC_ELEMENTS[GHC_ELEMENTS$ELEMENT %in% 'TMAX' &
GHC_ELEMENTS$YEAR >=1961 &
GHC_ELEMENTS$YEAR <=2010,
c('ID', 'YEAR', 'V01', 'V02', 'V03', 'V04', 'V05', 'V06', 'V07', 'V08', 'V09', 'V10', 'V11', 'V12')])
colnames(ghc_thigh) <- c('ID', 'YEAR', 'th01', 'th02', 'th03', 'th04', 'th05', 'th06', 'th07', 'th08', 'th09', 'th10', 'th11', 'th12')
ghc_t <- merge(ghc_tmean,ghc_tlow, by=c('ID','YEAR'), all.x=TRUE, all.y=TRUE)
ghc_t <- merge(ghc_t,ghc_thigh, by=c('ID','YEAR'), all.x=TRUE, all.y=TRUE)
ghc_t[,3:38] <- ghc_t[,3:38] / 100
ghc <- merge(ghc_t,ghc_prec, by.x=c('ID','YEAR'),by.y=c('ID','year'))
rm(ghc_thigh,ghc_tlow,ghc_tmean )
ghc$check <- (ghc$th01 + ghc$tl01 + ghc$th07 + ghc$th07 + ghc$p01 + ghc$p07)*0+1
ghc1990 <- ghc[ghc$YEAR >= 1961  & ghc$YEAR <= 1990,  ]
ghc1990checkyears <- aggregate(ghc1990[,'check'], by=list(ghc1990$ID), FUN= 'sum', na.rm=TRUE)
colnames(ghc1990checkyears) <- c('ID', 'ct1990')
ghc2010 <- ghc[ghc$YEAR >= 1981  & ghc$YEAR <= 2010,  ]
ghc2010checkyears <- aggregate(ghc2010[,'check'], by=list(ghc2010$ID), FUN= 'sum', na.rm=TRUE)
colnames(ghc2010checkyears) <- c('ID', 'ct2010')
ghccheckyears <- merge(ghc2010checkyears, ghc1990checkyears, by='ID')
rm(ghc2010checkyears, ghc1990checkyears)
selectID <- ghccheckyears[ghccheckyears$ct2010 >=20 & ghccheckyears$ct1990 >=20,'ID']
ghc <- ghc[ghc$ID %in% selectID,]
for (j in 1:12){
ghc[,which(colnames(ghc)=='t01')+j-1]<- ifelse(is.na(ghc[,which(colnames(ghc)=='t01')+j-1]),
(ghc[,which(colnames(ghc)=='tl01')+j-1] + ghc[,which(colnames(ghc)=='th01')+j-1])/2,
ghc[,which(colnames(ghc)=='t01')+j-1])
}
ghcpre <-  ghc[ghc$YEAR >= 1961  & ghc$YEAR <= 1990,]
ghc1990norm <- aggregate(ghcpre[,c(
't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12',
'p01', 'p02', 'p03', 'p04', 'p05', 'p06', 'p07', 'p08', 'p09', 'p10', 'p11', 'p12',
'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')],
by=list(ghcpre$ID), FUN = 'mean', na.rm=TRUE
)
ghcpre <-  ghc[ghc$YEAR >= 1981  & ghc$YEAR <= 2010,]
ghc2010norm <- aggregate(ghcpre[,c(
't01', 't02', 't03', 't04', 't05', 't06', 't07', 't08', 't09', 't10', 't11', 't12',
'p01', 'p02', 'p03', 'p04', 'p05', 'p06', 'p07', 'p08', 'p09', 'p10', 'p11', 'p12',
'tl01', 'tl02', 'tl03', 'tl04', 'tl05', 'tl06', 'tl07', 'tl08', 'tl09', 'tl10', 'tl11', 'tl12')],
by=list(ghcpre$ID), FUN = 'mean', na.rm=TRUE
)
ghc2010norm$Norm <- 2010
ghc1990norm$Norm <- 1990
ghc2010norm <- rbind(ghc2010norm, ghc1990norm)
colnames(ghc2010norm)[1] <- 'ID'
globstations <- merge(globstations,ghc2010norm, by='ID' )
rm(GHC_ELEMENTS, adjprecipitation, rawprecipitation, globhistclim, globhistoricecoregions, ghc, ghcpre, ghc_prec, ghc_thigh, ghc_t,
ghc_tlow, ghc1990norm, ghc2010norm, ghc1990, ghc2010, ghc2010checkyears, ghc1990checkyears, ghccheckyears)
globstations$Source <- "GHCN"
globstations$State <- ""
colnames(globstations)[which(colnames(globstations)=='ID')] <- "Station_ID"
colnames(globstations)[which(colnames(globstations)=='stnname')] <- "Station_Name"
colnames(globstations)[which(colnames(globstations)=='latitude')] <- "Latitude"
colnames(globstations)[which(colnames(globstations)=='longitude')] <- "Longitude"
colnames(globstations)[which(colnames(globstations)=='elev')] <- "Elevation"
colnames(globstations)
#norms----
Norms2010$p01 <- Norms2010$pp01*10
Norms2010$p02 <- Norms2010$pp02*10
Norms2010$p03 <- Norms2010$pp03*10
Norms2010$p04 <- Norms2010$pp04*10
Norms2010$p05 <- Norms2010$pp05*10
Norms2010$p06 <- Norms2010$pp06*10
Norms2010$p07 <- Norms2010$pp07*10
Norms2010$p08 <- Norms2010$pp08*10
Norms2010$p09 <- Norms2010$pp09*10
Norms2010$p10 <- Norms2010$pp10*10
Norms2010$p11 <- Norms2010$pp11*10
Norms2010$p12 <- Norms2010$pp12*10
Norms2010 <- merge(ecolink, Norms2010, by='Station_ID')
Norms2010$Norm <- 2010
Norms2010$Source <- "2010 Normals"
Norms2010pre <-Norms2010[!is.na(Norms2010$t01)&!is.na(Norms2010$t07)&!is.na(Norms2010$tl01)&!is.na(Norms2010$tl07)&!is.na(Norms2010$p01)&!is.na(Norms2010$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate$Station_ID <- ""
Biomeclimate$Station_Name <- ""
Biomeclimate$State <- ""
Biomeclimate$Norm <- 1990
Biomeclimate$Source <- "WorldClim.org"
Biomeclimatepre <-Biomeclimate[!is.na(Biomeclimate$t01)&!is.na(Biomeclimate$t07)&!is.na(Biomeclimate$tl01)&!is.na(Biomeclimate$tl07)&!is.na(Biomeclimate$p01)&!is.na(Biomeclimate$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate <- rbind(Biomeclimatepre,Norms2010pre)
globstationspre <-globstations[!is.na(globstations$t01)&!is.na(globstations$t07)&!is.na(globstations$tl01)&!is.na(globstations$tl07)&!is.na(globstations$p01)&!is.na(globstations$p07),c("ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
Biomeclimate <- rbind(Biomeclimate,globstationspre)
Biomeclimate <- merge(biomesummary, Biomeclimate, by='BIOME')
Biomeclimate$wts<- ifelse(Biomeclimate$Source %in% 'GHCN', 100,1)
#generate Uniq ID
Biomeclimate$ID <- seq.int(nrow(Biomeclimate))
rm(ecolink, Norms2010, Norms2010pre, biomesummary, Biomeclimatepre, globstationspre)
Biomeclimate<-Biomeclimate[,c("ID","ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm", "Source","wts", "Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
N1990 <- Biomeclimate[Biomeclimate$Norm == 1990,]
N2010 <- Biomeclimate[Biomeclimate$Norm == 2010,]
wwfregions1 <- aggregate(N1990[,c('ID')], by=list(N1990$ECO_ID,N1990$ECO_NAME), FUN='length')
colnames(wwfregions1) <- c('ECO_ID', 'ECO_NAME', 'N1990')
wwfregions2 <- aggregate(N2010[,c('ID')], by=list(N2010$ECO_ID,N2010$ECO_NAME), FUN='length')
colnames(wwfregions2) <- c('ECO_ID', 'ECO_NAME', 'N2010')
wwfregions<- merge(wwfregions2, wwfregions1[,c('ECO_ID', 'N1990')], by='ECO_ID', all.x = TRUE)
wwfregions$cht01 <- 0
wwfregions$cht02 <- 0
wwfregions$cht03 <- 0
wwfregions$cht04 <- 0
wwfregions$cht05 <- 0
wwfregions$cht06 <- 0
wwfregions$cht07 <- 0
wwfregions$cht08 <- 0
wwfregions$cht09 <- 0
wwfregions$cht10 <- 0
wwfregions$cht11 <- 0
wwfregions$cht12 <- 0
wwfregions$chtl01 <- 0
wwfregions$chtl02 <- 0
wwfregions$chtl03 <- 0
wwfregions$chtl04 <- 0
wwfregions$chtl05 <- 0
wwfregions$chtl06 <- 0
wwfregions$chtl07 <- 0
wwfregions$chtl08 <- 0
wwfregions$chtl09 <- 0
wwfregions$chtl10 <- 0
wwfregions$chtl11 <- 0
wwfregions$chtl12 <- 0
wwfregions$chp01 <- 0
wwfregions$chp02 <- 0
wwfregions$chp03 <- 0
wwfregions$chp04 <- 0
wwfregions$chp05 <- 0
wwfregions$chp06 <- 0
wwfregions$chp07 <- 0
wwfregions$chp08 <- 0
wwfregions$chp09 <- 0
wwfregions$chp10 <- 0
wwfregions$chp11 <- 0
wwfregions$chp12 <- 0
for (i in 1:nrow(wwfregions)){ #create a matrix that shows difference between the 1990 and 2010 normals by ecoregion.
selectbioclim <- Biomeclimate[Biomeclimate$ECO_ID %in% wwfregions[i,'ECO_ID'],    c("ID","ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm","wts","Latitude","Longitude","Elevation",
"t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12",
"tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12",
"p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12") ]
selectbioclim$v1 <- 0
for (j in 1:12){
selectbioclim$v1 <- selectbioclim[,which(colnames(selectbioclim)=='t01')+j-1]
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='cht01')+j-1] <-
as.numeric(model1$coef[5])
}
for (j in 1:12){
selectbioclim$v1 <- log(selectbioclim[,which(colnames(selectbioclim)=='p01')+j-1] +1 )
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='chp01')+j-1] <-
as.numeric(model1$coef[5])
}
for (j in 1:12){
selectbioclim$v1 <- log(selectbioclim[,which(colnames(selectbioclim)=='t01')+j-1] - selectbioclim[,which(colnames(selectbioclim)=='tl01')+j-1] + 1)
model1 = lm(v1 ~ Latitude + Longitude + Elevation + Norm, data=selectbioclim, weights = selectbioclim$wts)
wwfregions[i,which(colnames(wwfregions)=='chtl01')+j-1] <-
as.numeric(model1$coef[5])
}
}
bioclimatechange <- merge(Biomeclimate[Biomeclimate$Norm == 2010,], wwfregions, by=c('ECO_ID', 'ECO_NAME'))
bioclimatechange$newt01 <- 0
bioclimatechange$newt02 <- 0
bioclimatechange$newt03 <- 0
bioclimatechange$newt04 <- 0
bioclimatechange$newt05 <- 0
bioclimatechange$newt06 <- 0
bioclimatechange$newt07 <- 0
bioclimatechange$newt08 <- 0
bioclimatechange$newt09 <- 0
bioclimatechange$newt10 <- 0
bioclimatechange$newt11 <- 0
bioclimatechange$newt12 <- 0
bioclimatechange$newtl01 <- 0
bioclimatechange$newtl02 <- 0
bioclimatechange$newtl03 <- 0
bioclimatechange$newtl04 <- 0
bioclimatechange$newtl05 <- 0
bioclimatechange$newtl06 <- 0
bioclimatechange$newtl07 <- 0
bioclimatechange$newtl08 <- 0
bioclimatechange$newtl09 <- 0
bioclimatechange$newtl10 <- 0
bioclimatechange$newtl11 <- 0
bioclimatechange$newtl12 <- 0
bioclimatechange$newp01 <- 0
bioclimatechange$newp02 <- 0
bioclimatechange$newp03 <- 0
bioclimatechange$newp04 <- 0
bioclimatechange$newp05 <- 0
bioclimatechange$newp06 <- 0
bioclimatechange$newp07 <- 0
bioclimatechange$newp08 <- 0
bioclimatechange$newp09 <- 0
bioclimatechange$newp10 <- 0
bioclimatechange$newp11 <- 0
bioclimatechange$newp12 <- 0
for (j in 1:12){
bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='cht01')+j-1]*20
bioclimatechange[,which(colnames(bioclimatechange)=='newtl01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] - pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='tl01')+j-1] +1) - bioclimatechange[,which(colnames(bioclimatechange)=='chtl01')+j-1]*20) -1, 0) #predict low, ensure that low is never higher than mean.
bioclimatechange[,which(colnames(bioclimatechange)=='newp01')+j-1] <- pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='p01')+j-1] + 1) - bioclimatechange[,which(colnames(bioclimatechange)=='chp01')+j-1]*20) - 1, 0) #predict precip, ensure that precip is never negative.
}
bioclimatechange <- bioclimatechange[bioclimatechange$Source %in%'2010 Normals',]
for (j in 1:12){
bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1]
bioclimatechange[,which(colnames(bioclimatechange)=='tl01')+j-1] <-   bioclimatechange[,which(colnames(bioclimatechange)=='newtl01')+j-1]
bioclimatechange[,which(colnames(bioclimatechange)=='p01')+j-1] <-   bioclimatechange[,which(colnames(bioclimatechange)=='newp01')+j-1]
}
View(bioclimatechange)
selectbio <- Biomeclimate[Biomeclimate$ECO_ID %in% '70202',]
View(selectbio)
View(bioclimatechange)
bioclimatechange$Norm<- 1990
bioclimatechange<- bioclimatechange[,c("ID","ECO_ID","ECO_NAME","BIOME","Station_ID","Station_Name","State","Norm", "Source","Latitude","Longitude","Elevation","t01","t02","t03","t04","t05","t06","t07","t08","t09","t10","t11","t12","p01","p02","p03","p04","p05","p06","p07","p08","p09","p10","p11","p12","tl01","tl02","tl03","tl04","tl05","tl06","tl07","tl08","tl09","tl10","tl11","tl12")]
View(bioclimatechange)
Biomeclimate <- rbind(Biomeclimate, bioclimatechange)
bioclimatechange <- merge(Biomeclimate[Biomeclimate$Norm == 2010,], wwfregions, by=c('ECO_ID', 'ECO_NAME'))
bioclimatechange$newt01 <- 0
bioclimatechange$newt02 <- 0
bioclimatechange$newt03 <- 0
bioclimatechange$newt04 <- 0
bioclimatechange$newt05 <- 0
bioclimatechange$newt06 <- 0
bioclimatechange$newt07 <- 0
bioclimatechange$newt08 <- 0
bioclimatechange$newt09 <- 0
bioclimatechange$newt10 <- 0
bioclimatechange$newt11 <- 0
bioclimatechange$newt12 <- 0
bioclimatechange$newtl01 <- 0
bioclimatechange$newtl02 <- 0
bioclimatechange$newtl03 <- 0
bioclimatechange$newtl04 <- 0
bioclimatechange$newtl05 <- 0
bioclimatechange$newtl06 <- 0
bioclimatechange$newtl07 <- 0
bioclimatechange$newtl08 <- 0
bioclimatechange$newtl09 <- 0
bioclimatechange$newtl10 <- 0
bioclimatechange$newtl11 <- 0
bioclimatechange$newtl12 <- 0
bioclimatechange$newp01 <- 0
bioclimatechange$newp02 <- 0
bioclimatechange$newp03 <- 0
bioclimatechange$newp04 <- 0
bioclimatechange$newp05 <- 0
bioclimatechange$newp06 <- 0
bioclimatechange$newp07 <- 0
bioclimatechange$newp08 <- 0
bioclimatechange$newp09 <- 0
bioclimatechange$newp10 <- 0
bioclimatechange$newp11 <- 0
bioclimatechange$newp12 <- 0
for (j in 1:12){
bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='cht01')+j-1]*20
bioclimatechange[,which(colnames(bioclimatechange)=='newtl01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1] - pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] - bioclimatechange[,which(colnames(bioclimatechange)=='tl01')+j-1] +1) - bioclimatechange[,which(colnames(bioclimatechange)=='chtl01')+j-1]*20) -1, 0) #predict low, ensure that low is never higher than mean.
bioclimatechange[,which(colnames(bioclimatechange)=='newp01')+j-1] <- pmax(exp(log(bioclimatechange[,which(colnames(bioclimatechange)=='p01')+j-1] + 1) - bioclimatechange[,which(colnames(bioclimatechange)=='chp01')+j-1]*20) - 1, 0) #predict precip, ensure that precip is never negative.
}
bioclimatechange <- bioclimatechange[bioclimatechange$Source %in%'2010 Normals',]
for (j in 1:12){
bioclimatechange[,which(colnames(bioclimatechange)=='t01')+j-1] <- bioclimatechange[,which(colnames(bioclimatechange)=='newt01')+j-1]
bioclimatechange[,which(colnames(bioclimatechange)=='tl01')+j-1] <-   bioclimatechange[,which(colnames(bioclimatechange)=='newtl01')+j-1]
bioclimatechange[,which(colnames(bioclimatechange)=='p01')+j-1] <-   bioclimatechange[,which(colnames(bioclimatechange)=='newp01')+j-1]
}
bioclimatechange$Norm<- 1990
bioclimatechange<- bioclimatechange[,colnames(Biomeclimate)]
Biomeclimate <- rbind(Biomeclimate, bioclimatechange)
View(Biomeclimate)
